import os
import tempfile
from unittest.mock import patch, MagicMock, Mock, call

from PIL import Image
from nose.tools import assert_true, assert_equal

from practiceq.tasks import update_catalog, read_source_update_derivative, processimage


@patch('practiceq.tasks.tasks.Celery.backend')
def test_update_catalog(mock_backend):
    result = {
    "_id":"5bc06295b1164c2fcd9fc324",
    "department":"DigiLab",
    "derivatives":{
        "jpeg_040_antialias":{
            "pages":[
                {
                    "label":0,
                    "file":"https://bag.ou.edu/derivative/Abbati_1703/jpeg_040_antialias/data/001.jpg",
                    "sha256":"94020a6b2de62416631bcfa8f9ddb91638506f1b8fe5e70e36c7ddc4e4f9c73d",
                    "sha512":"09eccb401716fecee5a70944961b617ea83ee942362092c4dcef86d885a84f6a021fba5ab071b0e5901cef9fc3a4432e67203336d351e19030b875e73da35f22",
                    "exif":"001.jpg.exif.txt",
                    "uuid":"f2a2107b-6247-54ea-a80d-30dc57d59fe6"
                },
                {
                    "label":1,
                    "file":"https://bag.ou.edu/derivative/Abbati_1703/jpeg_040_antialias/data/002.jpg",
                    "sha256":"16a1033da6d6b8a5fe53fa8a1a6ac22465ce86a1790dd5e00692f8161a405853",
                    "sha512":"5e44654034ea3981b9de9e977bafa459e63334e7cbbccc7273cd18d7caddf8cd378833380baa25a0b42a04969baaef21fdcd3cb2e4e209910ac93d31f4ff1337",
                    "exif":"002.jpg.exif.txt",
                    "uuid":"b5194240-e77d-5e43-af84-84a5a5f84a70"
                },
                {
                    "label":2,
                    "file":"https://bag.ou.edu/derivative/Abbati_1703/jpeg_040_antialias/data/003.jpg",
                    "sha256":"9330b3c1d0a692aa035fa7d06f239aca85523899cd90484f584350e746e9ba6a",
                    "sha512":"a0bd1fa8377666025c6fb7f23554b4e23e26cbabb13a69d94efa7e8591607c3821fefea1abe6fd5b00e4e003262fdf7274b55b900f6b3772e71e3ab9f0b2db11",
                    "exif":"003.jpg.exif.txt",
                    "uuid":"b02164fb-06c5-531d-8384-68d82e1dd2b2"
                },
                {
                    "label":3,
                    "file":"https://bag.ou.edu/derivative/Abbati_1703/jpeg_040_antialias/data/004.jpg",
                    "sha256":"7be18ca901b4162e8868bc89f4607318904837c3bede1f7d25aea5bbe19bccc2",
                    "sha512":"808602c041128fe5fd98da073cfa0889c27ff55f5682a0768f9421c4fa092e31baa3204e4429edae933719a85cd68f8f249d274d6203a46cb8220fe77badf847",
                    "exif":"004.jpg.exif.txt",
                    "uuid":"aa1954a6-080a-508d-8f0a-033ef70d9e69"
                },
                {
                    "label":4,
                    "file":"https://bag.ou.edu/derivative/Abbati_1703/jpeg_040_antialias/data/005.jpg",
                    "sha256":"5d2b05fb15ebf07a309a29c8508070e3dda44225b4645036a9c7f5ef3a4e82b6",
                    "sha512":"968725e469c39e2d381ac6ec42f26efc19e1e0954ea7e74c97f1c33ef54a71d0654b244c48c4d07243e9e34beb9abf830a512e3c0a7b542616c6b7460bdf2325",
                    "exif":"005.jpg.exif.txt",
                    "uuid":"63e68b75-207b-5fa2-809c-29f6edf7d1e4"
                },
                {
                    "label":5,
                    "file":"https://bag.ou.edu/derivative/Abbati_1703/jpeg_040_antialias/data/006.jpg",
                    "sha256":"0384d5d85895715ae12a1f9e4fda57160fa04aca64d4a5485005fa478d63261c",
                    "sha512":"921b814c779bde15f5b67cd752b3f07107d3a08da2fec4ac7f502ac41614a2ec9ecef6b6f07c7e6f545b346b879ed13ba56df6d93d9b11cbe5b52d7121a943bb",
                    "exif":"006.jpg.exif.txt",
                    "uuid":"627933b2-4a3f-528c-8ceb-6d8fb564362b"
                },
                {
                    "label":6,
                    "file":"https://bag.ou.edu/derivative/Abbati_1703/jpeg_040_antialias/data/007.jpg",
                    "sha256":"ddb101fe0a5c3c95f6e0f0ff32d4cc6e8d7f4b27ee8f6c6b8194879d2738b335",
                    "sha512":"69840843faf04ae425e0633a37e4a9afcfdddb8d56b9f39a98a4fd0278e95c6b22bddf73ef259aca4455d7e6122d5789677ff702047f944fde0e1c16221f970a",
                    "exif":"007.jpg.exif.txt",
                    "uuid":"ea0e9c2c-8aaf-56bd-a9b2-5cf65d48df88"
                },
                {
                    "label":7,
                    "file":"https://bag.ou.edu/derivative/Abbati_1703/jpeg_040_antialias/data/008.jpg",
                    "sha256":"f98bc8a5dd83b3858a92425e4f4b2fca575445985ac6b3cdade67108a6898d3b",
                    "sha512":"1b9d2d50fbf198704693ef46bf28c492ca8506d68f383c2d4d1ef82e94001e645594bea59c1df69ebf021e6ef04fbae9e3efdfca1c447cab57d92b89b0f5ecb0",
                    "exif":"008.jpg.exif.txt",
                    "uuid":"938e373d-1aa7-5429-a54e-1f0574b18103"
                },
                {
                    "label":8,
                    "file":"https://bag.ou.edu/derivative/Abbati_1703/jpeg_040_antialias/data/009.jpg",
                    "sha256":"97d4ec8246c626ac30b357c67b3d4ccf0a97b4935cfcb9f280e5b7468aa34014",
                    "sha512":"1eafb7fa3b37e35cb235f107d522d3834b5f61147b085288674fee8071d60e4e3d52926cce8eae84bd4fa72455616e2fe0a16b7cbb78648d7d340cc1e4dfa253",
                    "exif":"009.jpg.exif.txt",
                    "uuid":"d9cd0f4d-f290-55f7-b188-a979f29e55fa"
                },
                {
                    "label":9,
                    "file":"https://bag.ou.edu/derivative/Abbati_1703/jpeg_040_antialias/data/010.jpg",
                    "sha256":"05f6bfebaf504a8fb7ecf8c7aa09b25d0045d7c3bca77f480ef137d5470ea0b2",
                    "sha512":"c143070636e771ec37e0ec7e6b7696983ccdbb6e9ea73eb1cc463495ec75f3936910ee3deab2f552d6fadb10360524c91ac438c42e7eb3ad5a5cf34de97cf635",
                    "exif":"010.jpg.exif.txt",
                    "uuid":"e48f80fb-e039-580b-9f35-029eee45698c"
                },
                {
                    "label":10,
                    "file":"https://bag.ou.edu/derivative/Abbati_1703/jpeg_040_antialias/data/011.jpg",
                    "sha256":"413d8d136a4edb22fde051f1d6a455cb9bde9cc57a1db73f83e2a7d23a353f0e",
                    "sha512":"deae301e573771ea864eed013f1a33ab7a89aa48b891989e770305efbab0d0a1bbdbaedf72deb2706ce7ace9031f4acc6e0ead64e8ee36ec8296bdc76556c35d",
                    "exif":"011.jpg.exif.txt",
                    "uuid":"1ec95635-fab1-5104-b8dc-43bb37f02aab"
                },
                {
                    "label":11,
                    "file":"https://bag.ou.edu/derivative/Abbati_1703/jpeg_040_antialias/data/012.jpg",
                    "sha256":"6e91aee28b352597a737e8e1eb40d4033a53bc541954f800ab4559b223e21489",
                    "sha512":"ec8d3ff178c0c7c3b287f129d437bd35d339feea110d2a10e2ab02670b36f7a5ca98b6ec810a4a18e792e2c5e190e2e799a9e4293398f5eb1af951774729122d",
                    "exif":"012.jpg.exif.txt",
                    "uuid":"0108bb8e-53a0-5b5d-bfac-cae8c32f2f86"
                },
                {
                    "label":12,
                    "file":"https://bag.ou.edu/derivative/Abbati_1703/jpeg_040_antialias/data/013.jpg",
                    "sha256":"5e81563aa03770ec645c0cf9b3f87322430e8e7975e05eacd142561f84e39611",
                    "sha512":"9d6fd9dc2bd590322386fe0c057fdc610c04a6d88f99663340a5099aee12ebdafd98a100ff016f5eabd0d3a2fc530ae25af9b49088f00020a9520a3d72e7907e",
                    "exif":"013.jpg.exif.txt",
                    "uuid":"a39efa63-6d4a-5fe6-b7f3-2aecff71b902"
                },
                {
                    "label":13,
                    "file":"https://bag.ou.edu/derivative/Abbati_1703/jpeg_040_antialias/data/014.jpg",
                    "sha256":"748ee16a121ba919a4c4fce59d79af9392f3f05e9563b63ae77c6b13f130fa20",
                    "sha512":"99b704a7ec33e7d2720e88a764b151304099fdfef4e3c68d2228edc632caf95397788f5c13aaaa279b5016563f32cdc133fa8613e62f2a6f02cca69d5de14da5",
                    "exif":"014.jpg.exif.txt",
                    "uuid":"6b568d8f-173c-5a2b-bca0-ed3a12049f58"
                },
                {
                    "label":14,
                    "file":"https://bag.ou.edu/derivative/Abbati_1703/jpeg_040_antialias/data/015.jpg",
                    "sha256":"18b5f7817f11ce95442501981819b43bc0fa1b791662641dc896269c17af5654",
                    "sha512":"7a815000158cd121821910291be266d4d159b966bdc3b305ace268d980841abd0a347061814e79e0b4dbf6af721f651b6c5670a69e66eb2260f46b79afac3cc7",
                    "exif":"015.jpg.exif.txt",
                    "uuid":"cdc60e43-427a-5684-8ead-c21c97759869"
                },
                {
                    "label":15,
                    "file":"https://bag.ou.edu/derivative/Abbati_1703/jpeg_040_antialias/data/016.jpg",
                    "sha256":"c917f3a3ee2e54001435ad80c6eb7d79d058fded366b8b301d8b037c10dd7b73",
                    "sha512":"3457d6345976c92f631e0aa64bf2144a029a881497661ce3d226f5e3cc9d0ca96fb03657f110adaefe126c5f01ef0d70074997c88f21742195714aa18285112c",
                    "exif":"016.jpg.exif.txt",
                    "uuid":"83a7dc44-34f2-5754-8ca1-5caf0adc0a60"
                },
                {
                    "label":16,
                    "file":"https://bag.ou.edu/derivative/Abbati_1703/jpeg_040_antialias/data/017.jpg",
                    "sha256":"6fca2875246a1d50f5aafd91edd03cb69957a0aa836b20641c71b2af02bd0653",
                    "sha512":"635168d94a7bb48f4b8c5512db5cf907350ded9ebcb97a5e6e07f97a30dbfdb6cfdc6c600bb2e804fd54251b9960bbbdd708816d4d5f9600a54408587d79542d",
                    "exif":"017.jpg.exif.txt",
                    "uuid":"9554590c-b44d-52d6-a1c8-b18078af556d"
                },
                {
                    "label":17,
                    "file":"https://bag.ou.edu/derivative/Abbati_1703/jpeg_040_antialias/data/018.jpg",
                    "sha256":"9676b08f33f32f5e244ad7f512a6f8196679274d3ef7b3394fde14da7902bfb2",
                    "sha512":"9945457c5fd83cd7bb0ac20c40ca5a95d5044e47dc750a1180af4aed93c339bfb5dedd41485e3f442e4f8e83de9a967a601a602e5d2d08b9011149d7b4d1abe6",
                    "exif":"018.jpg.exif.txt",
                    "uuid":"bc9d7865-a561-5515-9a6f-d6dd09bad9e8"
                },
                {
                    "label":18,
                    "file":"https://bag.ou.edu/derivative/Abbati_1703/jpeg_040_antialias/data/019.jpg",
                    "sha256":"cc2f405edba92404dd4190861330309c7ef79642902ad62e06f67202ff2d3eb3",
                    "sha512":"e40b56ca34a214890258c6df6c2407660684dc1169717809f95caddcb85c6e5285c2ef79d1d13ec1314e14ee5e5b7eb00a2c39ced5ef09fefb3692ca999c66f4",
                    "exif":"019.jpg.exif.txt",
                    "uuid":"46ae671c-cbcf-53fb-a461-8c06747a959b"
                },
                {
                    "label":19,
                    "file":"https://bag.ou.edu/derivative/Abbati_1703/jpeg_040_antialias/data/020.jpg",
                    "sha256":"88fa29dc534972713cd42c478d9f7d8f0995e9e108714b752a5bf9c052165669",
                    "sha512":"1c798ead493d5930b5908372573d3c975b7fb31ecd1b11fb14f6a77e3e754ffdddca88ae6f64eff0610ab9947514ebdffd2c4a2a63aabee49894f2ab676332e0",
                    "exif":"020.jpg.exif.txt",
                    "uuid":"9241baad-010a-5b35-9f50-258de5f2173c"
                },
                {
                    "label":20,
                    "file":"https://bag.ou.edu/derivative/Abbati_1703/jpeg_040_antialias/data/021.jpg",
                    "sha256":"2018e243ebdfc8e0be19c044b5a45edd080e6f4f08da6b7c734da6dd14a2fdf3",
                    "sha512":"82e3687ae5d576c8566d1decdea1ee4993178f16da33dc73dfa320fb2db8cf18cdca5964a47ffcd433bbb2cbf03560cd22a79687d7cf9bf357d21520b302d886",
                    "exif":"021.jpg.exif.txt",
                    "uuid":"d75fca8c-0e76-56f2-a1c4-6e596a2d333d"
                },
                {
                    "label":21,
                    "file":"https://bag.ou.edu/derivative/Abbati_1703/jpeg_040_antialias/data/022.jpg",
                    "sha256":"7dce903e365a69941611a87fa8ccea73babe79d3b423c1e65675420bb9b95176",
                    "sha512":"63990873a433a0de24427538f09a62bb62bf6d67f1c76c422c88f17688aad67629451680d5bee9a89ba20015f2d3f6a527c2c8126e9b56fae8fa5a6b1807532c",
                    "exif":"022.jpg.exif.txt",
                    "uuid":"59737620-dc4e-5e80-9f3a-32df49e5c960"
                },
                {
                    "label":22,
                    "file":"https://bag.ou.edu/derivative/Abbati_1703/jpeg_040_antialias/data/023.jpg",
                    "sha256":"a22d6bfed7aabcb2f23a46dec718d83b6413a38f33a9dd4c4d6552cdabaf6816",
                    "sha512":"d200be14bb927b180d667f4a8c9f74cf12be3e85bf15c5b88c6ee641847ab2a830165c0a7c43b69ea6bfed1cc637843a23a2548563c6877e7ec056b4a21f6031",
                    "exif":"023.jpg.exif.txt",
                    "uuid":"991a4e34-6ef0-5d56-aaea-de4c420b0824"
                },
                {
                    "label":23,
                    "file":"https://bag.ou.edu/derivative/Abbati_1703/jpeg_040_antialias/data/024.jpg",
                    "sha256":"2d8750611dde9c5d97f401ca88e0967c2bf916ab1f7948f520ebee8cc1f20f17",
                    "sha512":"b2081178095b2b04517c17590c87fdf7a285c293ea0c926eca4bf821a253c724add10f5fde2d3b1bc3281a5e4a1bd83d0a861c7b43aa45107d9c824ff9db2334",
                    "exif":"024.jpg.exif.txt",
                    "uuid":"23938cd2-98ba-56a0-b99d-b0eb4590fa9f"
                },
                {
                    "label":24,
                    "file":"https://bag.ou.edu/derivative/Abbati_1703/jpeg_040_antialias/data/025.jpg",
                    "sha256":"7360f5baf2c5dd16de8bc52ad87a309afc7dcb2ba4dde41d5877591b667039b5",
                    "sha512":"0f36b5b31a30034440b3a582fec9f3f7648f0234d25e30c1ca727521622c0408895d51a061c7ddaa7cf2e390e5863e0e0ab2737e125c035b8717dda3a7f35ddc",
                    "exif":"025.jpg.exif.txt",
                    "uuid":"cccb4920-d41a-5c13-8f6a-40e2c7eee4a3"
                },
                {
                    "label":25,
                    "file":"https://bag.ou.edu/derivative/Abbati_1703/jpeg_040_antialias/data/026.jpg",
                    "sha256":"bdad3773f94977f83537f26c305027760131088fa876eb99c576a98ceef46af1",
                    "sha512":"1cb60013563c53026021cb61067b76e81a176b13202601e7b7e17a4eb27ce5739226f4ee6dfb2ec1df1e5a7e2e9f47765311e7acd55f6a7ed34d82eb8401f079",
                    "exif":"026.jpg.exif.txt",
                    "uuid":"3c028318-165b-5ffd-8746-f2221dc622ac"
                },
                {
                    "label":26,
                    "file":"https://bag.ou.edu/derivative/Abbati_1703/jpeg_040_antialias/data/027.jpg",
                    "sha256":"a91931291fb35cf9e8667c336a78c127bdd43c6584cd9174de7a83d80b97c0fa",
                    "sha512":"d4d9da9b07ce898bd21929227fdbdf5a1096bf831ca8d5d5a75cb291b682c291f72f2b11a6fcaa6e2e6cf4662e1f758f8466b0dba46150a042f6ce963fe65b42",
                    "exif":"027.jpg.exif.txt",
                    "uuid":"03f895ad-dc52-5ad7-8bbf-792f018deaa3"
                },
                {
                    "label":27,
                    "file":"https://bag.ou.edu/derivative/Abbati_1703/jpeg_040_antialias/data/028.jpg",
                    "sha256":"c8806bad71018dd717fba1fb8e828d362a54ee004b057937d37394c1312a43f0",
                    "sha512":"58f9f4dda5a67ab15fbe817341e9c5d070a6a52e204098b583914696ec7353325053d061a16072e86745ef1d85fb195bd0211a9cbf22199b4056d85acfa8050e",
                    "exif":"028.jpg.exif.txt",
                    "uuid":"4682da85-e675-56ec-b4fd-af02daa44bd7"
                },
                {
                    "label":28,
                    "file":"https://bag.ou.edu/derivative/Abbati_1703/jpeg_040_antialias/data/029.jpg",
                    "sha256":"6347b76da700b2062b8ed45aec8b508dda3e961114b877f058113cf0463c1c6d",
                    "sha512":"1585c1cb1187c98ea1239586fd71ce548892dc82d5446f3cdcdcddb3a83f818e278cea63ffe022c44d9d2355c365b15df31bc5cb12d1183d6c99a2969e295dc3",
                    "exif":"029.jpg.exif.txt",
                    "uuid":"845d2476-6df6-568f-b180-2d0d57f03016"
                },
                {
                    "label":29,
                    "file":"https://bag.ou.edu/derivative/Abbati_1703/jpeg_040_antialias/data/030.jpg",
                    "sha256":"0e28a6b2ce4d76aae02451bf1f601d12edd85b3c4f217ac032357430939f2eea",
                    "sha512":"60280759ebe72a2dfe9d91f44bf0a49dd1be0d7a32a8fff105e2112e01b0730a5ef3f5df2bef4ef4e57834c68ac6fea42a297e8436698db35f8043ad8de58a1a",
                    "exif":"030.jpg.exif.txt",
                    "uuid":"b85d8ff0-5c2a-55d2-a4b6-335ff3475435"
                },
                {
                    "label":30,
                    "file":"https://bag.ou.edu/derivative/Abbati_1703/jpeg_040_antialias/data/031.jpg",
                    "sha256":"5eb87070b8f1e721607eabccdfabdae58254ff4125117f68d693cc028302e09c",
                    "sha512":"ca9ec808d9dbbe0178cb3dc5b8294a48fed3ba987a6f86f382d254ba6d3468a40a96f6ad7e32d7479a109341a040c54e5e9068679841d52a5fffab1dbd62dfc7",
                    "exif":"031.jpg.exif.txt",
                    "uuid":"df609b1e-a7ef-567e-8ae7-9af9a7a2f6b3"
                },
                {
                    "label":31,
                    "file":"https://bag.ou.edu/derivative/Abbati_1703/jpeg_040_antialias/data/032.jpg",
                    "sha256":"3a0a716645baf5e75a8aad62016fc7623f70283db8f26690dc2ed1131b39c098",
                    "sha512":"455482bc8a06a82ca967ef369380455468fa3caecf144a7f7ec4d7a9091e02d4a588732d6f1e071a12b9812810b9f7642f81cc7b7238005e8c828547de333b04",
                    "exif":"032.jpg.exif.txt",
                    "uuid":"f45ec44d-e333-55f8-bcc2-0e4557db7caa"
                },
                {
                    "label":32,
                    "file":"https://bag.ou.edu/derivative/Abbati_1703/jpeg_040_antialias/data/033.jpg",
                    "sha256":"88f155eaf5095b70ebdc5c33d9efc5489c686a0c4b734c5081a31f57261e182a",
                    "sha512":"eabcb8f65d53f7fa50867c54e3109d5286031863e7fe05194bfcc67a67c78b2b8b342309bddc93f99c9a22cbfc9d7681cd76e32f0ec23097f10fd895fbe71d08",
                    "exif":"033.jpg.exif.txt",
                    "uuid":"47e1bb58-11d8-5fa7-b6ec-823abadf8625"
                },
                {
                    "label":33,
                    "file":"https://bag.ou.edu/derivative/Abbati_1703/jpeg_040_antialias/data/034.jpg",
                    "sha256":"f798b5e19f8280c2412487b666fd8b24ca862accdc7835be4887823a70b8c6f9",
                    "sha512":"53a2705ad05d3d32f6a7f6d2fe58d45db5548c53ffc25620aeb48ca9b0b6b4862bd2cff2f206ad43377ee1eff295626cf8ebd2461e3fb7fcf0bb7b789fc683d8",
                    "exif":"034.jpg.exif.txt",
                    "uuid":"482eae29-0331-5b63-9d25-5144530584f3"
                }
            ],
            "recipe":"https://bag.ou.edu/derivative/Abbati_1703/jpeg_040_antialias/abbati_1703.json",
            "datetime":"2020-04-11T00:17:16.634576"
        }
    },
    "locations":{
        "norfile":{
            "exists":True,
            "valid":True,
            "validation_date":"",
            "location":"UL-BAGIT"
        },
        "s3":{
            "exists":True,
            "valid":True,
            "bucket":"ul-bagit",
            "error":[

            ],
            "verified":[
                "source/Abbati_1703/data/002.CR2",
                "source/Abbati_1703/data/029.CR2",
                "source/Abbati_1703/data/009.tif",
                "source/Abbati_1703/data/018.tif",
                "source/Abbati_1703/data/005.CR2",
                "source/Abbati_1703/data/018.CR2",
                "source/Abbati_1703/data/019.CR2",
                "source/Abbati_1703/data/024.tif",
                "source/Abbati_1703/data/015.CR2",
                "source/Abbati_1703/data/006.tif",
                "source/Abbati_1703/data/023.tif",
                "source/Abbati_1703/data/034.CR2",
                "source/Abbati_1703/data/008.CR2",
                "source/Abbati_1703/data/021.CR2",
                "source/Abbati_1703/data/026.CR2",
                "source/Abbati_1703/data/029.tif",
                "source/Abbati_1703/data/034.tif",
                "source/Abbati_1703/data/014.CR2",
                "source/Abbati_1703/data/032.CR2",
                "source/Abbati_1703/data/010.CR2",
                "source/Abbati_1703/data/019.tif",
                "source/Abbati_1703/data/012.CR2",
                "source/Abbati_1703/data/004.CR2",
                "source/Abbati_1703/data/lrcat.lrcat",
                "source/Abbati_1703/data/011.tif",
                "source/Abbati_1703/data/022.CR2",
                "source/Abbati_1703/data/012.tif",
                "source/Abbati_1703/data/014.tif",
                "source/Abbati_1703/data/030.tif",
                "source/Abbati_1703/data/013.tif",
                "source/Abbati_1703/data/003.tif",
                "source/Abbati_1703/data/009.CR2",
                "source/Abbati_1703/data/020.CR2",
                "source/Abbati_1703/data/015.tif",
                "source/Abbati_1703/data/001.CR2",
                "source/Abbati_1703/data/027.CR2",
                "source/Abbati_1703/data/020.tif",
                "source/Abbati_1703/data/028.CR2",
                "source/Abbati_1703/data/011.CR2",
                "source/Abbati_1703/data/010.tif",
                "source/Abbati_1703/data/001.tif",
                "source/Abbati_1703/data/035.CR2",
                "source/Abbati_1703/data/008.tif",
                "source/Abbati_1703/data/007.tif",
                "source/Abbati_1703/data/024.CR2",
                "source/Abbati_1703/data/007.CR2",
                "source/Abbati_1703/data/004.tif",
                "source/Abbati_1703/data/030.CR2",
                "source/Abbati_1703/data/005.tif",
                "source/Abbati_1703/data/013.CR2",
                "source/Abbati_1703/data/017.tif",
                "source/Abbati_1703/data/021.tif",
                "source/Abbati_1703/data/028.tif",
                "source/Abbati_1703/data/027.tif",
                "source/Abbati_1703/data/003.CR2",
                "source/Abbati_1703/data/026.tif",
                "source/Abbati_1703/data/025.tif",
                "source/Abbati_1703/data/036.CR2",
                "source/Abbati_1703/data/023.CR2",
                "source/Abbati_1703/data/006.CR2",
                "source/Abbati_1703/data/022.tif",
                "source/Abbati_1703/data/031.CR2",
                "source/Abbati_1703/data/033.CR2",
                "source/Abbati_1703/data/025.CR2",
                "source/Abbati_1703/data/016.CR2",
                "source/Abbati_1703/data/017.CR2",
                "source/Abbati_1703/data/031.tif",
                "source/Abbati_1703/data/016.tif",
                "source/Abbati_1703/data/032.tif",
                "source/Abbati_1703/data/002.tif",
                "source/Abbati_1703/data/033.tif"
            ],
            "validation_date":"",
            "manifest":"/mnt/autofs/norfile/UL-BAGIT/Abbati_1703/manifest-md5.txt"
        },
        "nas":{
            "exists":False,
            "location":"/mnt/autofs/nas2/bagit2/Abbati_1703",
            "place_holder":True,
            "error":""
        }
    },
    "bag":"Abbati_1703",
    "project":"bag_and_ingest",
    "application":{
        "islandora":{
            "derivative":"jpeg_040_antialias",
            "ingested":True,
            "datetime":"2019-09-03T19:49:09.850571",
            "collection":"oku:hos"
        }
    }
}
    mock_backend.app.backend.database.client.cybercom.catalog.find_one.return_value = result
    actual_result = update_catalog("Abbati_1703","jpeg_antialias")
    assert_true(actual_result)
"""
@patch('practiceq.tasks.tasks.Celery.backend')
def test_update_catalog_second_functionality(mock_backend):
    result = {
    "_id":"5bc06295b1164c2fcd9fc324",
    "department":"DigiLab",
    "derivatives":{
    },
    "locations":{
        "norfile":{
            "exists":True,
            "valid":True,
            "validation_date":"",
            "location":"UL-BAGIT"
        },
        "s3":{
            "exists":True,
            "valid":True,
            "bucket":"ul-bagit",
            "error":[

            ],
            "verified":[
                "source/Abbati_1703/data/002.CR2",
                "source/Abbati_1703/data/029.CR2",
                "source/Abbati_1703/data/009.tif",
                "source/Abbati_1703/data/018.tif",
                "source/Abbati_1703/data/005.CR2",
                "source/Abbati_1703/data/018.CR2",
                "source/Abbati_1703/data/019.CR2",
                "source/Abbati_1703/data/024.tif",
                "source/Abbati_1703/data/015.CR2",
                "source/Abbati_1703/data/006.tif",
                "source/Abbati_1703/data/023.tif",
                "source/Abbati_1703/data/034.CR2",
                "source/Abbati_1703/data/008.CR2",
                "source/Abbati_1703/data/021.CR2",
                "source/Abbati_1703/data/026.CR2",
                "source/Abbati_1703/data/029.tif",
                "source/Abbati_1703/data/034.tif",
                "source/Abbati_1703/data/014.CR2",
                "source/Abbati_1703/data/032.CR2",
                "source/Abbati_1703/data/010.CR2",
                "source/Abbati_1703/data/019.tif",
                "source/Abbati_1703/data/012.CR2",
                "source/Abbati_1703/data/004.CR2",
                "source/Abbati_1703/data/lrcat.lrcat",
                "source/Abbati_1703/data/011.tif",
                "source/Abbati_1703/data/022.CR2",
                "source/Abbati_1703/data/012.tif",
                "source/Abbati_1703/data/014.tif",
                "source/Abbati_1703/data/030.tif",
                "source/Abbati_1703/data/013.tif",
                "source/Abbati_1703/data/003.tif",
                "source/Abbati_1703/data/009.CR2",
                "source/Abbati_1703/data/020.CR2",
                "source/Abbati_1703/data/015.tif",
                "source/Abbati_1703/data/001.CR2",
                "source/Abbati_1703/data/027.CR2",
                "source/Abbati_1703/data/020.tif",
                "source/Abbati_1703/data/028.CR2",
                "source/Abbati_1703/data/011.CR2",
                "source/Abbati_1703/data/010.tif",
                "source/Abbati_1703/data/001.tif",
                "source/Abbati_1703/data/035.CR2",
                "source/Abbati_1703/data/008.tif",
                "source/Abbati_1703/data/007.tif",
                "source/Abbati_1703/data/024.CR2",
                "source/Abbati_1703/data/007.CR2",
                "source/Abbati_1703/data/004.tif",
                "source/Abbati_1703/data/030.CR2",
                "source/Abbati_1703/data/005.tif",
                "source/Abbati_1703/data/013.CR2",
                "source/Abbati_1703/data/017.tif",
                "source/Abbati_1703/data/021.tif",
                "source/Abbati_1703/data/028.tif",
                "source/Abbati_1703/data/027.tif",
                "source/Abbati_1703/data/003.CR2",
                "source/Abbati_1703/data/026.tif",
                "source/Abbati_1703/data/025.tif",
                "source/Abbati_1703/data/036.CR2",
                "source/Abbati_1703/data/023.CR2",
                "source/Abbati_1703/data/006.CR2",
                "source/Abbati_1703/data/022.tif",
                "source/Abbati_1703/data/031.CR2",
                "source/Abbati_1703/data/033.CR2",
                "source/Abbati_1703/data/025.CR2",
                "source/Abbati_1703/data/016.CR2",
                "source/Abbati_1703/data/017.CR2",
                "source/Abbati_1703/data/031.tif",
                "source/Abbati_1703/data/016.tif",
                "source/Abbati_1703/data/032.tif",
                "source/Abbati_1703/data/002.tif",
                "source/Abbati_1703/data/033.tif"
            ],
            "validation_date":"",
            "manifest":"/mnt/autofs/norfile/UL-BAGIT/Abbati_1703/manifest-md5.txt"
        },
        "nas":{
            "exists":False,
            "location":"/mnt/autofs/nas2/bagit2/Abbati_1703",
            "place_holder":True,
            "error":""
        }
    },
    "bag":"Abbati_1703",
    "project":"bag_and_ingest",
    "application":{
        "islandora":{
            "derivative":"jpeg_040_antialias",
            "ingested":True,
            "datetime":"2019-09-03T19:49:09.850571",
            "collection":"oku:hos"
        }
    }
}
    response ={
    "_id":"5bc06295b1164c2fcd9fc324",
    "department":"DigiLab",
    "derivatives":{
        "jpeg_040_antialias":{
            "pages":[
                {
                    "label":0,
                    "file":"https://bag.ou.edu/derivative/Abbati_1703/jpeg_040_antialias/data/001.jpg",
                    "sha256":"94020a6b2de62416631bcfa8f9ddb91638506f1b8fe5e70e36c7ddc4e4f9c73d",
                    "sha512":"09eccb401716fecee5a70944961b617ea83ee942362092c4dcef86d885a84f6a021fba5ab071b0e5901cef9fc3a4432e67203336d351e19030b875e73da35f22",
                    "exif":"001.jpg.exif.txt",
                    "uuid":"f2a2107b-6247-54ea-a80d-30dc57d59fe6"
                },
                {
                    "label":1,
                    "file":"https://bag.ou.edu/derivative/Abbati_1703/jpeg_040_antialias/data/002.jpg",
                    "sha256":"16a1033da6d6b8a5fe53fa8a1a6ac22465ce86a1790dd5e00692f8161a405853",
                    "sha512":"5e44654034ea3981b9de9e977bafa459e63334e7cbbccc7273cd18d7caddf8cd378833380baa25a0b42a04969baaef21fdcd3cb2e4e209910ac93d31f4ff1337",
                    "exif":"002.jpg.exif.txt",
                    "uuid":"b5194240-e77d-5e43-af84-84a5a5f84a70"
                },
                {
                    "label":2,
                    "file":"https://bag.ou.edu/derivative/Abbati_1703/jpeg_040_antialias/data/003.jpg",
                    "sha256":"9330b3c1d0a692aa035fa7d06f239aca85523899cd90484f584350e746e9ba6a",
                    "sha512":"a0bd1fa8377666025c6fb7f23554b4e23e26cbabb13a69d94efa7e8591607c3821fefea1abe6fd5b00e4e003262fdf7274b55b900f6b3772e71e3ab9f0b2db11",
                    "exif":"003.jpg.exif.txt",
                    "uuid":"b02164fb-06c5-531d-8384-68d82e1dd2b2"
                },
                {
                    "label":3,
                    "file":"https://bag.ou.edu/derivative/Abbati_1703/jpeg_040_antialias/data/004.jpg",
                    "sha256":"7be18ca901b4162e8868bc89f4607318904837c3bede1f7d25aea5bbe19bccc2",
                    "sha512":"808602c041128fe5fd98da073cfa0889c27ff55f5682a0768f9421c4fa092e31baa3204e4429edae933719a85cd68f8f249d274d6203a46cb8220fe77badf847",
                    "exif":"004.jpg.exif.txt",
                    "uuid":"aa1954a6-080a-508d-8f0a-033ef70d9e69"
                },
                {
                    "label":4,
                    "file":"https://bag.ou.edu/derivative/Abbati_1703/jpeg_040_antialias/data/005.jpg",
                    "sha256":"5d2b05fb15ebf07a309a29c8508070e3dda44225b4645036a9c7f5ef3a4e82b6",
                    "sha512":"968725e469c39e2d381ac6ec42f26efc19e1e0954ea7e74c97f1c33ef54a71d0654b244c48c4d07243e9e34beb9abf830a512e3c0a7b542616c6b7460bdf2325",
                    "exif":"005.jpg.exif.txt",
                    "uuid":"63e68b75-207b-5fa2-809c-29f6edf7d1e4"
                },
                {
                    "label":5,
                    "file":"https://bag.ou.edu/derivative/Abbati_1703/jpeg_040_antialias/data/006.jpg",
                    "sha256":"0384d5d85895715ae12a1f9e4fda57160fa04aca64d4a5485005fa478d63261c",
                    "sha512":"921b814c779bde15f5b67cd752b3f07107d3a08da2fec4ac7f502ac41614a2ec9ecef6b6f07c7e6f545b346b879ed13ba56df6d93d9b11cbe5b52d7121a943bb",
                    "exif":"006.jpg.exif.txt",
                    "uuid":"627933b2-4a3f-528c-8ceb-6d8fb564362b"
                },
                {
                    "label":6,
                    "file":"https://bag.ou.edu/derivative/Abbati_1703/jpeg_040_antialias/data/007.jpg",
                    "sha256":"ddb101fe0a5c3c95f6e0f0ff32d4cc6e8d7f4b27ee8f6c6b8194879d2738b335",
                    "sha512":"69840843faf04ae425e0633a37e4a9afcfdddb8d56b9f39a98a4fd0278e95c6b22bddf73ef259aca4455d7e6122d5789677ff702047f944fde0e1c16221f970a",
                    "exif":"007.jpg.exif.txt",
                    "uuid":"ea0e9c2c-8aaf-56bd-a9b2-5cf65d48df88"
                },
                {
                    "label":7,
                    "file":"https://bag.ou.edu/derivative/Abbati_1703/jpeg_040_antialias/data/008.jpg",
                    "sha256":"f98bc8a5dd83b3858a92425e4f4b2fca575445985ac6b3cdade67108a6898d3b",
                    "sha512":"1b9d2d50fbf198704693ef46bf28c492ca8506d68f383c2d4d1ef82e94001e645594bea59c1df69ebf021e6ef04fbae9e3efdfca1c447cab57d92b89b0f5ecb0",
                    "exif":"008.jpg.exif.txt",
                    "uuid":"938e373d-1aa7-5429-a54e-1f0574b18103"
                },
                {
                    "label":8,
                    "file":"https://bag.ou.edu/derivative/Abbati_1703/jpeg_040_antialias/data/009.jpg",
                    "sha256":"97d4ec8246c626ac30b357c67b3d4ccf0a97b4935cfcb9f280e5b7468aa34014",
                    "sha512":"1eafb7fa3b37e35cb235f107d522d3834b5f61147b085288674fee8071d60e4e3d52926cce8eae84bd4fa72455616e2fe0a16b7cbb78648d7d340cc1e4dfa253",
                    "exif":"009.jpg.exif.txt",
                    "uuid":"d9cd0f4d-f290-55f7-b188-a979f29e55fa"
                },
                {
                    "label":9,
                    "file":"https://bag.ou.edu/derivative/Abbati_1703/jpeg_040_antialias/data/010.jpg",
                    "sha256":"05f6bfebaf504a8fb7ecf8c7aa09b25d0045d7c3bca77f480ef137d5470ea0b2",
                    "sha512":"c143070636e771ec37e0ec7e6b7696983ccdbb6e9ea73eb1cc463495ec75f3936910ee3deab2f552d6fadb10360524c91ac438c42e7eb3ad5a5cf34de97cf635",
                    "exif":"010.jpg.exif.txt",
                    "uuid":"e48f80fb-e039-580b-9f35-029eee45698c"
                },
                {
                    "label":10,
                    "file":"https://bag.ou.edu/derivative/Abbati_1703/jpeg_040_antialias/data/011.jpg",
                    "sha256":"413d8d136a4edb22fde051f1d6a455cb9bde9cc57a1db73f83e2a7d23a353f0e",
                    "sha512":"deae301e573771ea864eed013f1a33ab7a89aa48b891989e770305efbab0d0a1bbdbaedf72deb2706ce7ace9031f4acc6e0ead64e8ee36ec8296bdc76556c35d",
                    "exif":"011.jpg.exif.txt",
                    "uuid":"1ec95635-fab1-5104-b8dc-43bb37f02aab"
                },
                {
                    "label":11,
                    "file":"https://bag.ou.edu/derivative/Abbati_1703/jpeg_040_antialias/data/012.jpg",
                    "sha256":"6e91aee28b352597a737e8e1eb40d4033a53bc541954f800ab4559b223e21489",
                    "sha512":"ec8d3ff178c0c7c3b287f129d437bd35d339feea110d2a10e2ab02670b36f7a5ca98b6ec810a4a18e792e2c5e190e2e799a9e4293398f5eb1af951774729122d",
                    "exif":"012.jpg.exif.txt",
                    "uuid":"0108bb8e-53a0-5b5d-bfac-cae8c32f2f86"
                },
                {
                    "label":12,
                    "file":"https://bag.ou.edu/derivative/Abbati_1703/jpeg_040_antialias/data/013.jpg",
                    "sha256":"5e81563aa03770ec645c0cf9b3f87322430e8e7975e05eacd142561f84e39611",
                    "sha512":"9d6fd9dc2bd590322386fe0c057fdc610c04a6d88f99663340a5099aee12ebdafd98a100ff016f5eabd0d3a2fc530ae25af9b49088f00020a9520a3d72e7907e",
                    "exif":"013.jpg.exif.txt",
                    "uuid":"a39efa63-6d4a-5fe6-b7f3-2aecff71b902"
                },
                {
                    "label":13,
                    "file":"https://bag.ou.edu/derivative/Abbati_1703/jpeg_040_antialias/data/014.jpg",
                    "sha256":"748ee16a121ba919a4c4fce59d79af9392f3f05e9563b63ae77c6b13f130fa20",
                    "sha512":"99b704a7ec33e7d2720e88a764b151304099fdfef4e3c68d2228edc632caf95397788f5c13aaaa279b5016563f32cdc133fa8613e62f2a6f02cca69d5de14da5",
                    "exif":"014.jpg.exif.txt",
                    "uuid":"6b568d8f-173c-5a2b-bca0-ed3a12049f58"
                },
                {
                    "label":14,
                    "file":"https://bag.ou.edu/derivative/Abbati_1703/jpeg_040_antialias/data/015.jpg",
                    "sha256":"18b5f7817f11ce95442501981819b43bc0fa1b791662641dc896269c17af5654",
                    "sha512":"7a815000158cd121821910291be266d4d159b966bdc3b305ace268d980841abd0a347061814e79e0b4dbf6af721f651b6c5670a69e66eb2260f46b79afac3cc7",
                    "exif":"015.jpg.exif.txt",
                    "uuid":"cdc60e43-427a-5684-8ead-c21c97759869"
                },
                {
                    "label":15,
                    "file":"https://bag.ou.edu/derivative/Abbati_1703/jpeg_040_antialias/data/016.jpg",
                    "sha256":"c917f3a3ee2e54001435ad80c6eb7d79d058fded366b8b301d8b037c10dd7b73",
                    "sha512":"3457d6345976c92f631e0aa64bf2144a029a881497661ce3d226f5e3cc9d0ca96fb03657f110adaefe126c5f01ef0d70074997c88f21742195714aa18285112c",
                    "exif":"016.jpg.exif.txt",
                    "uuid":"83a7dc44-34f2-5754-8ca1-5caf0adc0a60"
                },
                {
                    "label":16,
                    "file":"https://bag.ou.edu/derivative/Abbati_1703/jpeg_040_antialias/data/017.jpg",
                    "sha256":"6fca2875246a1d50f5aafd91edd03cb69957a0aa836b20641c71b2af02bd0653",
                    "sha512":"635168d94a7bb48f4b8c5512db5cf907350ded9ebcb97a5e6e07f97a30dbfdb6cfdc6c600bb2e804fd54251b9960bbbdd708816d4d5f9600a54408587d79542d",
                    "exif":"017.jpg.exif.txt",
                    "uuid":"9554590c-b44d-52d6-a1c8-b18078af556d"
                },
                {
                    "label":17,
                    "file":"https://bag.ou.edu/derivative/Abbati_1703/jpeg_040_antialias/data/018.jpg",
                    "sha256":"9676b08f33f32f5e244ad7f512a6f8196679274d3ef7b3394fde14da7902bfb2",
                    "sha512":"9945457c5fd83cd7bb0ac20c40ca5a95d5044e47dc750a1180af4aed93c339bfb5dedd41485e3f442e4f8e83de9a967a601a602e5d2d08b9011149d7b4d1abe6",
                    "exif":"018.jpg.exif.txt",
                    "uuid":"bc9d7865-a561-5515-9a6f-d6dd09bad9e8"
                },
                {
                    "label":18,
                    "file":"https://bag.ou.edu/derivative/Abbati_1703/jpeg_040_antialias/data/019.jpg",
                    "sha256":"cc2f405edba92404dd4190861330309c7ef79642902ad62e06f67202ff2d3eb3",
                    "sha512":"e40b56ca34a214890258c6df6c2407660684dc1169717809f95caddcb85c6e5285c2ef79d1d13ec1314e14ee5e5b7eb00a2c39ced5ef09fefb3692ca999c66f4",
                    "exif":"019.jpg.exif.txt",
                    "uuid":"46ae671c-cbcf-53fb-a461-8c06747a959b"
                },
                {
                    "label":19,
                    "file":"https://bag.ou.edu/derivative/Abbati_1703/jpeg_040_antialias/data/020.jpg",
                    "sha256":"88fa29dc534972713cd42c478d9f7d8f0995e9e108714b752a5bf9c052165669",
                    "sha512":"1c798ead493d5930b5908372573d3c975b7fb31ecd1b11fb14f6a77e3e754ffdddca88ae6f64eff0610ab9947514ebdffd2c4a2a63aabee49894f2ab676332e0",
                    "exif":"020.jpg.exif.txt",
                    "uuid":"9241baad-010a-5b35-9f50-258de5f2173c"
                },
                {
                    "label":20,
                    "file":"https://bag.ou.edu/derivative/Abbati_1703/jpeg_040_antialias/data/021.jpg",
                    "sha256":"2018e243ebdfc8e0be19c044b5a45edd080e6f4f08da6b7c734da6dd14a2fdf3",
                    "sha512":"82e3687ae5d576c8566d1decdea1ee4993178f16da33dc73dfa320fb2db8cf18cdca5964a47ffcd433bbb2cbf03560cd22a79687d7cf9bf357d21520b302d886",
                    "exif":"021.jpg.exif.txt",
                    "uuid":"d75fca8c-0e76-56f2-a1c4-6e596a2d333d"
                },
                {
                    "label":21,
                    "file":"https://bag.ou.edu/derivative/Abbati_1703/jpeg_040_antialias/data/022.jpg",
                    "sha256":"7dce903e365a69941611a87fa8ccea73babe79d3b423c1e65675420bb9b95176",
                    "sha512":"63990873a433a0de24427538f09a62bb62bf6d67f1c76c422c88f17688aad67629451680d5bee9a89ba20015f2d3f6a527c2c8126e9b56fae8fa5a6b1807532c",
                    "exif":"022.jpg.exif.txt",
                    "uuid":"59737620-dc4e-5e80-9f3a-32df49e5c960"
                },
                {
                    "label":22,
                    "file":"https://bag.ou.edu/derivative/Abbati_1703/jpeg_040_antialias/data/023.jpg",
                    "sha256":"a22d6bfed7aabcb2f23a46dec718d83b6413a38f33a9dd4c4d6552cdabaf6816",
                    "sha512":"d200be14bb927b180d667f4a8c9f74cf12be3e85bf15c5b88c6ee641847ab2a830165c0a7c43b69ea6bfed1cc637843a23a2548563c6877e7ec056b4a21f6031",
                    "exif":"023.jpg.exif.txt",
                    "uuid":"991a4e34-6ef0-5d56-aaea-de4c420b0824"
                },
                {
                    "label":23,
                    "file":"https://bag.ou.edu/derivative/Abbati_1703/jpeg_040_antialias/data/024.jpg",
                    "sha256":"2d8750611dde9c5d97f401ca88e0967c2bf916ab1f7948f520ebee8cc1f20f17",
                    "sha512":"b2081178095b2b04517c17590c87fdf7a285c293ea0c926eca4bf821a253c724add10f5fde2d3b1bc3281a5e4a1bd83d0a861c7b43aa45107d9c824ff9db2334",
                    "exif":"024.jpg.exif.txt",
                    "uuid":"23938cd2-98ba-56a0-b99d-b0eb4590fa9f"
                },
                {
                    "label":24,
                    "file":"https://bag.ou.edu/derivative/Abbati_1703/jpeg_040_antialias/data/025.jpg",
                    "sha256":"7360f5baf2c5dd16de8bc52ad87a309afc7dcb2ba4dde41d5877591b667039b5",
                    "sha512":"0f36b5b31a30034440b3a582fec9f3f7648f0234d25e30c1ca727521622c0408895d51a061c7ddaa7cf2e390e5863e0e0ab2737e125c035b8717dda3a7f35ddc",
                    "exif":"025.jpg.exif.txt",
                    "uuid":"cccb4920-d41a-5c13-8f6a-40e2c7eee4a3"
                },
                {
                    "label":25,
                    "file":"https://bag.ou.edu/derivative/Abbati_1703/jpeg_040_antialias/data/026.jpg",
                    "sha256":"bdad3773f94977f83537f26c305027760131088fa876eb99c576a98ceef46af1",
                    "sha512":"1cb60013563c53026021cb61067b76e81a176b13202601e7b7e17a4eb27ce5739226f4ee6dfb2ec1df1e5a7e2e9f47765311e7acd55f6a7ed34d82eb8401f079",
                    "exif":"026.jpg.exif.txt",
                    "uuid":"3c028318-165b-5ffd-8746-f2221dc622ac"
                },
                {
                    "label":26,
                    "file":"https://bag.ou.edu/derivative/Abbati_1703/jpeg_040_antialias/data/027.jpg",
                    "sha256":"a91931291fb35cf9e8667c336a78c127bdd43c6584cd9174de7a83d80b97c0fa",
                    "sha512":"d4d9da9b07ce898bd21929227fdbdf5a1096bf831ca8d5d5a75cb291b682c291f72f2b11a6fcaa6e2e6cf4662e1f758f8466b0dba46150a042f6ce963fe65b42",
                    "exif":"027.jpg.exif.txt",
                    "uuid":"03f895ad-dc52-5ad7-8bbf-792f018deaa3"
                },
                {
                    "label":27,
                    "file":"https://bag.ou.edu/derivative/Abbati_1703/jpeg_040_antialias/data/028.jpg",
                    "sha256":"c8806bad71018dd717fba1fb8e828d362a54ee004b057937d37394c1312a43f0",
                    "sha512":"58f9f4dda5a67ab15fbe817341e9c5d070a6a52e204098b583914696ec7353325053d061a16072e86745ef1d85fb195bd0211a9cbf22199b4056d85acfa8050e",
                    "exif":"028.jpg.exif.txt",
                    "uuid":"4682da85-e675-56ec-b4fd-af02daa44bd7"
                },
                {
                    "label":28,
                    "file":"https://bag.ou.edu/derivative/Abbati_1703/jpeg_040_antialias/data/029.jpg",
                    "sha256":"6347b76da700b2062b8ed45aec8b508dda3e961114b877f058113cf0463c1c6d",
                    "sha512":"1585c1cb1187c98ea1239586fd71ce548892dc82d5446f3cdcdcddb3a83f818e278cea63ffe022c44d9d2355c365b15df31bc5cb12d1183d6c99a2969e295dc3",
                    "exif":"029.jpg.exif.txt",
                    "uuid":"845d2476-6df6-568f-b180-2d0d57f03016"
                },
                {
                    "label":29,
                    "file":"https://bag.ou.edu/derivative/Abbati_1703/jpeg_040_antialias/data/030.jpg",
                    "sha256":"0e28a6b2ce4d76aae02451bf1f601d12edd85b3c4f217ac032357430939f2eea",
                    "sha512":"60280759ebe72a2dfe9d91f44bf0a49dd1be0d7a32a8fff105e2112e01b0730a5ef3f5df2bef4ef4e57834c68ac6fea42a297e8436698db35f8043ad8de58a1a",
                    "exif":"030.jpg.exif.txt",
                    "uuid":"b85d8ff0-5c2a-55d2-a4b6-335ff3475435"
                },
                {
                    "label":30,
                    "file":"https://bag.ou.edu/derivative/Abbati_1703/jpeg_040_antialias/data/031.jpg",
                    "sha256":"5eb87070b8f1e721607eabccdfabdae58254ff4125117f68d693cc028302e09c",
                    "sha512":"ca9ec808d9dbbe0178cb3dc5b8294a48fed3ba987a6f86f382d254ba6d3468a40a96f6ad7e32d7479a109341a040c54e5e9068679841d52a5fffab1dbd62dfc7",
                    "exif":"031.jpg.exif.txt",
                    "uuid":"df609b1e-a7ef-567e-8ae7-9af9a7a2f6b3"
                },
                {
                    "label":31,
                    "file":"https://bag.ou.edu/derivative/Abbati_1703/jpeg_040_antialias/data/032.jpg",
                    "sha256":"3a0a716645baf5e75a8aad62016fc7623f70283db8f26690dc2ed1131b39c098",
                    "sha512":"455482bc8a06a82ca967ef369380455468fa3caecf144a7f7ec4d7a9091e02d4a588732d6f1e071a12b9812810b9f7642f81cc7b7238005e8c828547de333b04",
                    "exif":"032.jpg.exif.txt",
                    "uuid":"f45ec44d-e333-55f8-bcc2-0e4557db7caa"
                },
                {
                    "label":32,
                    "file":"https://bag.ou.edu/derivative/Abbati_1703/jpeg_040_antialias/data/033.jpg",
                    "sha256":"88f155eaf5095b70ebdc5c33d9efc5489c686a0c4b734c5081a31f57261e182a",
                    "sha512":"eabcb8f65d53f7fa50867c54e3109d5286031863e7fe05194bfcc67a67c78b2b8b342309bddc93f99c9a22cbfc9d7681cd76e32f0ec23097f10fd895fbe71d08",
                    "exif":"033.jpg.exif.txt",
                    "uuid":"47e1bb58-11d8-5fa7-b6ec-823abadf8625"
                },
                {
                    "label":33,
                    "file":"https://bag.ou.edu/derivative/Abbati_1703/jpeg_040_antialias/data/034.jpg",
                    "sha256":"f798b5e19f8280c2412487b666fd8b24ca862accdc7835be4887823a70b8c6f9",
                    "sha512":"53a2705ad05d3d32f6a7f6d2fe58d45db5548c53ffc25620aeb48ca9b0b6b4862bd2cff2f206ad43377ee1eff295626cf8ebd2461e3fb7fcf0bb7b789fc683d8",
                    "exif":"034.jpg.exif.txt",
                    "uuid":"482eae29-0331-5b63-9d25-5144530584f3"
                }
            ],
            "recipe":"https://bag.ou.edu/derivative/Abbati_1703/jpeg_040_antialias/abbati_1703.json",
            "datetime":"2020-04-11T00:17:16.634576"
        }
    },
    "locations":{
        "norfile":{
            "exists":True,
            "valid":True,
            "validation_date":"",
            "location":"UL-BAGIT"
        },
        "s3":{
            "exists":True,
            "valid":True,
            "bucket":"ul-bagit",
            "error":[

            ],
            "verified":[
                "source/Abbati_1703/data/002.CR2",
                "source/Abbati_1703/data/029.CR2",
                "source/Abbati_1703/data/009.tif",
                "source/Abbati_1703/data/018.tif",
                "source/Abbati_1703/data/005.CR2",
                "source/Abbati_1703/data/018.CR2",
                "source/Abbati_1703/data/019.CR2",
                "source/Abbati_1703/data/024.tif",
                "source/Abbati_1703/data/015.CR2",
                "source/Abbati_1703/data/006.tif",
                "source/Abbati_1703/data/023.tif",
                "source/Abbati_1703/data/034.CR2",
                "source/Abbati_1703/data/008.CR2",
                "source/Abbati_1703/data/021.CR2",
                "source/Abbati_1703/data/026.CR2",
                "source/Abbati_1703/data/029.tif",
                "source/Abbati_1703/data/034.tif",
                "source/Abbati_1703/data/014.CR2",
                "source/Abbati_1703/data/032.CR2",
                "source/Abbati_1703/data/010.CR2",
                "source/Abbati_1703/data/019.tif",
                "source/Abbati_1703/data/012.CR2",
                "source/Abbati_1703/data/004.CR2",
                "source/Abbati_1703/data/lrcat.lrcat",
                "source/Abbati_1703/data/011.tif",
                "source/Abbati_1703/data/022.CR2",
                "source/Abbati_1703/data/012.tif",
                "source/Abbati_1703/data/014.tif",
                "source/Abbati_1703/data/030.tif",
                "source/Abbati_1703/data/013.tif",
                "source/Abbati_1703/data/003.tif",
                "source/Abbati_1703/data/009.CR2",
                "source/Abbati_1703/data/020.CR2",
                "source/Abbati_1703/data/015.tif",
                "source/Abbati_1703/data/001.CR2",
                "source/Abbati_1703/data/027.CR2",
                "source/Abbati_1703/data/020.tif",
                "source/Abbati_1703/data/028.CR2",
                "source/Abbati_1703/data/011.CR2",
                "source/Abbati_1703/data/010.tif",
                "source/Abbati_1703/data/001.tif",
                "source/Abbati_1703/data/035.CR2",
                "source/Abbati_1703/data/008.tif",
                "source/Abbati_1703/data/007.tif",
                "source/Abbati_1703/data/024.CR2",
                "source/Abbati_1703/data/007.CR2",
                "source/Abbati_1703/data/004.tif",
                "source/Abbati_1703/data/030.CR2",
                "source/Abbati_1703/data/005.tif",
                "source/Abbati_1703/data/013.CR2",
                "source/Abbati_1703/data/017.tif",
                "source/Abbati_1703/data/021.tif",
                "source/Abbati_1703/data/028.tif",
                "source/Abbati_1703/data/027.tif",
                "source/Abbati_1703/data/003.CR2",
                "source/Abbati_1703/data/026.tif",
                "source/Abbati_1703/data/025.tif",
                "source/Abbati_1703/data/036.CR2",
                "source/Abbati_1703/data/023.CR2",
                "source/Abbati_1703/data/006.CR2",
                "source/Abbati_1703/data/022.tif",
                "source/Abbati_1703/data/031.CR2",
                "source/Abbati_1703/data/033.CR2",
                "source/Abbati_1703/data/025.CR2",
                "source/Abbati_1703/data/016.CR2",
                "source/Abbati_1703/data/017.CR2",
                "source/Abbati_1703/data/031.tif",
                "source/Abbati_1703/data/016.tif",
                "source/Abbati_1703/data/032.tif",
                "source/Abbati_1703/data/002.tif",
                "source/Abbati_1703/data/033.tif"
            ],
            "validation_date":"",
            "manifest":"/mnt/autofs/norfile/UL-BAGIT/Abbati_1703/manifest-md5.txt"
        },
        "nas":{
            "exists":False,
            "location":"/mnt/autofs/nas2/bagit2/Abbati_1703",
            "place_holder":True,
            "error":""
        }
    },
    "bag":"Abbati_1703",
    "project":"bag_and_ingest",
    "application":{
        "islandora":{
            "derivative":"jpeg_040_antialias",
            "ingested":True,
            "datetime":"2019-09-03T19:49:09.850571",
            "collection":"oku:hos"
        }
    }
}
    mock_backend.database.client.cybercom.catalog.find_one.return_value = response
    #mock_backend.database.client.cybercom.catalog.update_one.return_value = response
    actual_result = update_catalog("Abbati_1703","jpeg_antialias","659855504521")
    #assert_equal(actual_result,response)
    assert_true(actual_result)

"""
@patch('practiceq.tasks.tasks.Celery.backend')
def test_update_catalog_break(mock_backend):
    #result = None
    mock_backend.database.client.cybercom.catalog.find_one.return_value = None
    actual_result = update_catalog("Abbati_1703","jpeg_antialias","659855504521")
    assert_equal(actual_result,False)

import glob
@patch('practiceq.tasks.tasks.get_mmsid')
@patch('practiceq.tasks.tasks.check_output')
@patch('practiceq.tasks.tasks.glob.glob')
@patch('practiceq.tasks.tasks.processimage')
def test_read_source_update_derivative(image_1,paths,output,mmsid):
    with tempfile.TemporaryDirectory() as tmpdir:
        image = Image.new("RGB", size=(100, 100), color=(256, 0, 0))
        image.save(tmpdir + "/test.tif", "tiff")
        image = Image.new("RGB", size=(100, 100), color=(256, 0, 0))
        image.save(tmpdir + "/test-1.tif", "tiff")
        #temppaths = glob.glob(os.path.join(tmpdir, "*.tif"))
        mmsid.return_value = "987587412125"
        output.return_value = "jpeg_040_antialias"
        paths.return_value = ["temppaths","cc"]
        image_1.return_value= Mock()
        read_source_update_derivative(["Abbati_1703"], s3_source="source", s3_destination="derivative", outformat="JPEG",
                                      filter='ANTIALIAS', scale=0.4, crop=None, mount_point="mnt")

        image_1.assert_called()
        assert_equal(image_1.call_count,2)

@patch('practiceq.tasks.tasks.update_catalog')
@patch('practiceq.tasks.tasks.get_mmsid')
def test_read_source_update_derivative_no_mmsid(mmsid,catalog_mock):
    with tempfile.TemporaryDirectory() as tmpdir:
        mmsid.return_value = None
        catalog_mock.return_value= Mock()
        read_source_update_derivative(["Abbati_1703"], s3_source="source", s3_destination="derivative", outformat="JPEG",
                                      filter='ANTIALIAS', scale=0.4, crop=None, mount_point="mnt")

        catalog_mock.assert_called()


@patch('practiceq.tasks.tasks.bag_derivative')
@patch('practiceq.tasks.tasks.recipe_file_creation')
@patch('practiceq.tasks.tasks.update_catalog')
def test_process_recipe(catalog_mock,recipe_mock,bag_mock):
    bag_mock.return_value = Mock()

    expected = [
        call.bag_derivative('foo'),
        call.function2('bar'),
        call.function3('baz')
    ]